---
title: 掘金小测《Mysql是怎么样运行的》
date: 2020-08-28 23:41:12
categories: 
           - mysql
tags:
           - mysql
---

# 一、初识MySQL

![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghx36atrp3j30ne0fjtat.jpg)

MySql表的默认存储引擎是`InnoDB`

# 三、字符集和比较规则

> 1. `字符集`指的是某个字符范围的编码规则。
> 2. `比较规则`是针对某个字符集中的字符比较大小的一种规则。

## 一些重要的字符集

- `ASCII`字符集

    共收录128个字符，包括空格、标点符号、数字、大小写字母和一些不可见字符。由于总共才128个字符，所以可以使用1个字节来进行编码.

- `GB2312`字符集

    收录了汉字以及拉丁字母、希腊字母、日文平假名及片假名字母、俄语西里尔字母。如果该字符在`ASCII`字符集中，则采用1字节编码，否则采用2字节编码.

- `GBK`字符集（win系统）

    只是在收录字符范围上对`GB2312`字符集作了扩充，编码方式上兼容`GB2312`。

- `utf8`字符集（Unix系统）

    收录地球上能想到的所有字符，而且还在不断扩充。这种字符集兼容`ASCII`字符集，采用变长编码方式，编码一个字符需要使用1～4个字节.

## MySQL中的utf8mb4

- `utf8mb3`：阉割过的`utf8`字符集，只使用1～3个字节表示字符。
- `utf8mb4`：正宗的`utf8`字符集，使用1～4个字节表示字符。

而在`MySQL`中字符集表示一个字符所用最大字节长度在某些方面会影响系统的存储和性能。`MySQL`使中的`utf8`指的是`utf8mb3`。

查看mysql支持的字符集`show charset;`。

## MySQL四个级别的字符集和比较规则

`MySQL`有4个级别的字符集和比较规则，分别是：

- 服务器级别

`character_set_server`表示服务器级别的字符集，`collation_server`表示服务器级别的比较规则。

- 数据库级别

创建和修改数据库时可以指定字符集和比较规则；`character_set_database`表示当前数据库的字符集，`collation_database`表示当前默认数据库的比较规则，这两个系统变量是只读的，不能修改。若没有指定，则使用服务器级别。

- 表级别

创建和修改表的时候指定表的字符集和比较规则；若没有指定，则使用数据库级别

- 列级别

创建和修改列定义的时候可以指定该列的字符集和比较规则；若没有指定，则使用表级别；



## 发送请求到接收结果过程中发生的字符集转换

![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghx2ea3gsrj30r20d1416.jpg)

- 客户端使用操作系统的字符集编码请求字符串，向服务器发送的是经过编码的一个字节串。
- 服务器将客户端发送来的字节串采用`character_set_client`代表的字符集进行解码，将解码后的字符串再按照`character_set_connection`代表的字符集进行编码。
- 如果`character_set_connection`代表的字符集和具体操作的列使用的字符集一致，则直接进行相应操作，否则的话需要将请求中的字符串从`character_set_connection`代表的字符集转换为具体操作的列使用的字符集之后再进行操作。
- 将从某个列获取到的字节串从该列使用的字符集转换为`character_set_results`代表的字符集后发送到客户端。
- 客户端使用操作系统的字符集解析收到的结果集字节串。

在这个过程中各个系统变量的含义如下：

|          系统变量          |                             描述                             |
| :------------------------: | :----------------------------------------------------------: |
|   `character_set_client`   |                 服务器解码请求时使用的字符集                 |
| `character_set_connection` | 服务器处理请求时会把请求字符串从`character_set_client`转为`character_set_connection` |
|  `character_set_results`   |             服务器向客户端返回数据时使用的字符集             |

一般情况下要使用保持这三个变量的值和客户端使用的字符集相同。

## 比较规则

比较规则的作用通常体现比较字符串大小的表达式以及对某个字符串列进行排序中。





# 四、InoDB记录存储结构

1. 页是`MySQL`中磁盘和内存交互的基本单位，也是`MySQL`是管理存储空间的基本单位。

2. 指定和修改行格式的语法如下：

    ```
    CREATE TABLE 表名 (列的信息) ROW_FORMAT=行格式名称
    
    ALTER TABLE 表名 ROW_FORMAT=行格式名称
    ```

3. `InnoDB`目前定义了4种行格式

    - COMPACT行格式

        具体组成如图：

        ![image_1c9g4t114n0j1gkro2r1h8h1d1t16.png-42.4kB](https://user-gold-cdn.xitu.io/2019/3/12/169710e8fafc21aa?imageView2/0/w/1280/h/960/ignore-error/1)

        

    - Redundant行格式

        具体组成如图：

        ![image_1ctfppb4c1cng1m8718l91760jde9.png-36.2kB](https://user-gold-cdn.xitu.io/2019/3/12/169710e9ca9cbeb5?imageView2/0/w/1280/h/960/ignore-error/1)

        

    - Dynamic和Compressed行格式

        这两种行格式类似于`COMPACT行格式`，只不过在处理行溢出数据时有点儿分歧，它们不会在记录的真实数据处存储字符串的前768个字节，而是把所有的字节都存储到其他页面中，只在记录的真实数据处存储其他页面的地址。

        另外，`Compressed`行格式会采用压缩算法对页面进行压缩。

- 一个页一般是`16KB`，当记录中的数据太多，当前页放不下的时候，会把多余的数据存储到其他页中，这种现象称为`行溢出`。





