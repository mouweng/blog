---
title: B树与B+树
date: 2020-08-26 23:41:12
categories: 
           - mysql
tags:
           - B树
           - B+树
---

[B tree演示动画](https://www.cs.usfca.edu/~galles/visualization/BTree.html)

[B+ tree演示动画](https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html)

## 背景

动态查找树主要包括：二叉搜索树，平衡二叉树，红黑树，B树

B树时间复杂度O(log2N)，通过对树高度的降低可以提升查找效率，尤其是在大量数据进行存储时会存储到外部磁盘，通过对外部磁盘的读取需要快速查找到对应位置，所以需要一种高效的外存数据结构。

**B树&B+树：就是为了存储设备或磁盘而设计的一种所有结点平衡因子均等于0的多路查找树**



## B树

#### 定义

> 对于一棵m阶的B树
>
> 1）树中的每个节点最多有m个孩子 
>
> 2）除了根节点和叶子节点外，其他节点最少含有m/2（取上限）个孩子 
>
> 3）若根节点不是叶子节点，则根节点最少含有两个孩子 
>
> 4）所以叶子节点都在同一层，且叶子结点为NULL



#### 查找

```
和二叉查找树过程类似，只是为多叉查找。
比较的次数并不比二叉查找树少，尤其适当某一节点中的数据很多时，但是磁盘IO的次数却是大大减少。比较是在内存中进行的（即在找到目标节点后，先将结点中的信息读入内存），相比于磁盘IO的速度，比较的耗时几乎可以忽略。所以当树的高度足够低的话，就可以极大的提高效率。
```

#### 插入

```
对于高度为h的m阶B树，新节点一般插在第h层。	
1）若该节点中关键码个数小于m-1，则直接插入
2）若该节点中关键码个数等于m-1，则节点分裂。以中间的关键码为界，
	 将节点一分为二，产生一个新的节点，并将中间关键码插入到父节点中。
重复上述过程，最坏情况一直分裂高根节点，则B树就会增加一层。
```

#### 删除

```
情况一：删除的关键字K不在终端结点
（1）从k的前驱选取最大或者后继子树中选取最小来替代K即可，只要满足前驱或后继关键字个数大于m/2(向上取整)-1.
（2）如果前驱和后继均不满足，直接将前驱和后继合并，然后删除K.
情况二：删除的关键字在终端结点（第h层）
（1）自己够删，关键字所在结点关键字个数足够（关键字大于m/2(向上取整)-1），关键字直接删除
（2）兄弟够借，兄弟关键字所在结点关键字个数足够（关键字大于m/2(向上取整)-1），关键字删除，借父亲一位，兄弟顶父亲。
（3）兄弟不够借，把关键字删除，自己、兄弟、以及父亲那一位关键字合并。
```





## B+树

Ｂ＋树是Ｂ树的变种，有着比Ｂ树更高的查询效率。

#### 定义

> 1）有k个子树的中间节点包含有k个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引。
>
> 2）所有分支结点中仅包含各个子节点中关键字最大的值和指向其子节点的指针。 
>
> 3）所有的叶子结点中包含了全部元素的信息，及指向含这些元素记录的指针，且叶子结点本身依关键字自小而大顺序链接。
>
> 4）B+树通常有两个指针，一个指向根结点，另一个指向关键字最小的叶子结点。因些，对于B+树进行查找两种运算：一种是从最小关键字起顺序查找，另一种是从根结点开始，进行随机查找。



#### 插入

B+树的插入与B树的插入过程类似。不同的是B+树在叶结点上进行，如果叶结点中的关键码个数超过m，就必须分裂成关键码数目大致相同的两个结点，并保证上层结点中有这两个结点的最大关键码。



#### 删除

B+树中的关键码在叶结点层删除后，其在上层的复本可以保留，作为一个”分解关键码”存在，如果因为删除而造成结点中关键码数小于ceil(m/2)，其处理过程与B树的处理一样。





## 总结

#### B+树相比B树的优势：

1. 单一节点存储更多的元素，使得查询的IO次数更少； 
2. 所有查询都要查找到叶子节点，查询性能稳定； 
3. 所有叶子节点形成有序链表，便于范围查询。



#### 具体分析

（1）Ｂ＋树中间节点没有卫星数据（索引元素所指向的数据记录），只有索引。而Ｂ树每个结点中的每个关键字都有卫星数据；这就意味着同样的大小的磁盘页可以容纳更多节点元素，在相同的数据量下，Ｂ＋树更加“矮胖”，Ｉ/Ｏ操作更少 。

- B树的卫星数据 

![](https://tva1.sinaimg.cn/large/006tNbRwgy1g9kzd2h1s8j30hs08mq33.jpg)

- B+树的卫星数据

![](https://tva1.sinaimg.cn/large/006tNbRwgy1g9kzdb6uawj30hs085glq.jpg)

（2）Ｂ树的查找只需找到匹配元素即可，最好情况下查找到根节点，最坏情况下查找到叶子结点，所说性能很不稳定，而Ｂ＋树每次必须查找到叶子结点，性能稳定 

（3）在范围查询方面，B+树的优势更加明显 
　　B树的范围查找需要不断依赖中序遍历。首先二分查找到范围下限，在不断通过中序遍历，知道查找到范围的上限即可。整个过程比较耗时。 
　　而B+树的范围查找则简单了许多。首先通过二分查找，找到范围下限，然后同过叶子结点的链表顺序遍历，直至找到上限即可，整个过程简单许多，效率也比较高。 

​		例如：同样查找范围[3-11]，两者的查询过程如下： 

- B树的查找过程

![](https://tva1.sinaimg.cn/large/006tNbRwgy1g9kzgov58aj30fo0g0406.jpg)

- B+树的查找过程

![](https://tva1.sinaimg.cn/large/006tNbRwgy1g9kzhlqaftj30pq0iw786.jpg)